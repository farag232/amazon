'use strict';mix_d("VSEDistributionCards__vse-vw-dp-card:vse-vw-dp-card__iEJfFRMt","exports tslib @p/A @c/scoped-dom @c/weblabs @c/logger @c/metrics @p/a-modal @c/aui-untrusted-ajax @c/navigation".split(" "),function(aa,O,pa,qa,ra,sa,S,ta,ua,va){function y(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var c=y(pa),D=y(qa),wa=y(ra),xa=y(sa),ya=y(ta),za=y(ua),ba=y(va),z,E=function(a,b){Object.keys(a).length!==b.requiredNumOfFields&&S.count("invalidNumOfFields-"+b.producerId,1);a=JSON.stringify(a).replace(/\\\\/g,
"");S.event(JSON.parse(a),b.producerId,b.schemaId,{ssd:!1})},Aa=function(a){return function(b){return c["default"].$.extend({eventSource:a.eventSource,placementContext:a.placementContext,clientId:a.clientId,timestamp:new Date,userAgentData:navigator.userAgent,titleSessionId:"0",videoAsin:"",videoAsinList:a.videoAsinList||"",creativeId:a.creativeId,stringPayload:a.stringPayload||""},b)}},d={pageType:"",clientPrefix:"",deviceType:"",placement:"",metricsPlacement:"",cardId:"",creativeId:"",requester:"",
buildCsmPayload:function(a){}},p=function(a,b){void 0===b&&(b=1);try{S.count("vse:csm:cards:"+d.clientPrefix+":"+a,b)}catch(e){v("failed to post CSM metric","ERROR")}},A=function(a,b){void 0===b&&(b=1);p(a+":"+d.deviceType,b)},v=function(a,b){xa["default"].log("VSEWidgetCards: "+a+". Client prefix: "+d.clientPrefix+", Page type: "+d.pageType,b,"VSEDistributionCards")},ca=function(a,b,e){try{if(c["default"].$("."+d.cardId).length){var k=!1,g=b.map(function(h){return h.contentId}).join(","),l=d.buildCsmPayload({eventName:d.clientPrefix+
":cardWidgetRendered",intPayload:1,videoAsinList:g});E(l,z);p("cardWidgetRendered",1);var m=function(){for(var h=e.carouselItemClassName,n=0;n<b.length;n++)if(!b[n].impressionRecorded){var r=c["default"].$("."+d.cardId+" ."+h+":nth-child("+(n+1)+")");if(c["default"].onScreen(r,0))r=d.buildCsmPayload({eventName:d.clientPrefix+":thumbnailImpression",intPayload:n,videoAsin:b[n].contentId}),E(r,z),b[n].impressionRecorded=!0;else break}},f=function(){if(k)c["default"].off(c["default"].constants.BROWSER_EVENTS.SCROLL,
f);else{var h=d.buildCsmPayload({eventName:d.clientPrefix+":cardWidgetScrolledInView",intPayload:1,videoAsinList:g}),n=c["default"].$("."+d.cardId+" ."+e.carouselItemClassName).first();n&&c["default"].onScreen(n,0)&&(E(h,z),h=c["default"].now()-a,p("cardWidgetScrolledInViewTime",h),A("cardWidgetScrolledInView"),k=!0,m())}};f();c["default"].on(c["default"].constants.BROWSER_EVENTS.SCROLL,f);e.widgetMetricsHandler(m,function(h){var n=d.buildCsmPayload({eventName:d.clientPrefix+":"+h+":paginationButtonClicked",
intPayload:1});p(h+":paginationButtonClicked",1);E(n,z)})}}catch(h){v("Error occurred while emitting widget metrics "+h,"ERROR"),p("widgetMetricsEmissionError")}},T=function(a,b,e,k,g){void 0===g&&(g=3);g--;za["default"].post(a,{accepts:"*/*",contentType:"application/json;charset=UTF-8",timeout:3E3},b).then(function(l){e(l)}).catch(function(l){0===l.statusCode?v("Request has failed with unknown status code. Payload: "+JSON.stringify(b),"ERROR"):0<g?T(a,b,e,k,g):k(l)})},Ba=function(a,b){a="/gp/mobile/tag/?ref=vse_cards_ingress"+
a+b.replace("/?_encoding=UTF8","");T(a,{},function(){},function(){})},Ca=function(a,b,e,k,g){var l=a.map(function(m){delete m.htmlEl;return m});b||(b=da(a[0],{}));T(e.nilgiriEndpoint,{requester:d.requester,clientPrefix:d.clientPrefix,page:d.pageType,placement:d.placement,device:d.deviceType,metadata:{id:"vse-video-widget-card",celQueryStringParam:e.celQueryStringParam,requestHasVideoData:"true"},videoDataList:l,video:{contentID:b.contentId,contentIDType:"VIDEO_ID",videoURL:b.videoUrl,imageURL:b.imageUrl,
vendorCode:b.vendorCode,vendorTrackingId:b.vendorTrackingId,videoReferenceId:b.videoReferenceId,videoTitle:b.title},marketplaceID:e.marketplaceId,locale:e.locale,product:{contentID:b.productAsin,contentIDType:"ASIN",parentContentID:b.parentAsin,parentContentIDType:"ASIN"},creativeId:d.creativeId},k,g)},da=function(a,b){var e=a.productAsin;e||c["default"].objectIsEmpty(a.metadata.relatedProductsAsins)||(e=a.metadata.relatedProductsAsins.split(",")[0]);var k=a.contentId,g=a.metadata.title,l=a.metadata.vendorName,
m=a.metadata.vendorCode,f=a.metadata.fullReviewLink,h=a.metadata.title,n=a.metadata.videoURL,r=a.metadata.formattedDuration,J=a.metadata.videoImageUrl,K=a.parentAsin,L="vse-cards-ingress"+a.index,Da=a.metadata.relatedProductsAsins,Ea=a.metadata.vendorTrackingId,Fa=a.metadata.referenceId,Ga=a.index,w=a.metadata.closedCaptions,ea=[];if(w&&(w=w.split(","),0===w.length%2))for(var M=0;M<w.length;M+=2)void 0!==w[M+1]&&ea.push({locale:w[M],url:w[M+1]});return{contentId:k,title:g,vendorName:l,vendorCode:m,
referenceUrl:f,referenceLinkTitle:h,videoUrl:n,duration:r,imageUrl:J,videoVoteContainer:{},productAsin:e,parentAsin:K,refTag:L,relatedProducts:Da,vendorTrackingId:Ea,videoReferenceId:Fa,index:Ga,$el:b,closedCaptions:ea,videoDetailPageLink:a.metadata.videoDetailPageLink,impressionRecorded:a.impressionRecorded,lastPlayingTimestamp:a.lastPlayingTimestamp,htmlEl:a.htmlEl,aciContentId:a.metadata.aciContentId,videoMimeType:a.metadata.videoMimeType}},U=function(a,b,e){var k=[];[].forEach.call(a,function(g,
l){var m=g.dataset.asin,f=g.dataset;if(m){k.push({contentId:m,productAsin:f.productAsin||"",parentAsin:f.parentAsin||"",metadata:{videoImageUrl:f.videoImageUrlUnchanged||f.videoImageUrl||"",videoURL:f.videoUrl||f.videoURL||"",title:f.title||"",formattedDuration:f.formattedDuration||"",vendorName:f.vendorName||"",vendorCode:f.vendorCode||"",referenceId:f.referenceId||"",fullReviewLink:f.referenceUrl||"",videoDetailPageLink:f.videoDetailPageLink||"vdp/"+m+b.celQueryStringParam,asin:f.asin||"",vendorTrackingId:f.vendorTrackingId||
"",relatedProductsAsins:f.relatedProductsAsins||"",closedCaptions:f.closedCaptions||"",creatorType:f.creatorType||"",publicName:f.publicName||"",profileLink:f.profileLink||"",profileImageUrl:f.profileImageUrl||"",aciContentId:f.csaCItemId||"",videoMimeType:f.videoMimeType||"",videoImageHeight:f.videoImageHeight||"",videoImageWidth:f.videoImageWidth||"",videoImagePhysicalId:f.videoImagePhysicalId||"",videoImageExtension:f.videoImageExtension||"",groupType:f.groupType||""},impressionRecorded:!1,lastPlayingTimestamp:0,
index:l,htmlEl:g});g=D["default"].cardRoot.getElementsByClassName(e.vseVideoDataItem)[l];try{f.profileLink&&f.profileImageUrl&&g&&fa(g,g.querySelector("."+e.vseProfilePlaceholder),e.vseVideoThumbnailProfile)}catch(h){v("Exception has occurred while initializing profiles. Exception details: "+h,"ERROR"),p("profileInitializationFailure",1)}try{""!==f.disclosureText&&""!==f.disclosureLink&&g&&fa(g,g.querySelector("."+e.vseVideoCreatorContainer),e.vseVideoDisclosure)}catch(h){v("Exception has occurred while moving the disclosure link. Exception details: "+
h,"ERROR"),p("moveDisclosureElementFailure",1)}}});return k},fa=function(a,b,e){a=a.querySelector("."+e);b&&a&&a.parentNode&&(b.appendChild(a.cloneNode(!0)),a.parentNode.removeChild(a),(b=b.querySelector("."+e))&&b.classList.remove("aok-hidden"))},t,P=!1,ha,V,F,q,G,W=!1,X,N,H,u,B,C,Q,R=!1,Ma=function(a,b,e,k,g){void 0===g&&(g=!1);return O.__awaiter(void 0,void 0,void 0,function(){var l,m,f;return O.__generator(this,function(h){try{G=e;q=b;F=a;R=g;l=c["default"].now();z={schemaId:"vse.VSECardsEvents.6",
producerId:"vsemetrics_widgetcards",requiredNumOfFields:12};C=D["default"].cardRoot.getElementsByClassName(q.vseVideoDataItem);if(!C)return p("noCardsIngressDom"),I(),[2];if((m=D["default"].cardRoot.getElementsByClassName(q.vseWidgetPageState))&&m[0]&&m[0].dataset){B=m[0].dataset;t=U(C,B,q);h=B;var n=void 0,r,J;void 0===n&&(n="vse_cards");d.deviceType=F?"Mobile":"Desktop";d.pageType=h.client||"Gateway";d.clientPrefix=d.pageType.toLowerCase();d.placement=("Detail"===d.pageType?"VWDP":d.pageType)+"Card-"+
d.deviceType;d.metricsPlacement=(c["default"].capabilities.mobile?c["default"].capabilities.isAmazonApp?"mobile_app":"mobile_web":c["default"].capabilities.tablet?c["default"].capabilities.isAmazonApp?"tablet_app":"tablet_web":"desktop_web")+"."+d.placement+"."+n;d.cardId=null!==(r=h.cardId)&&void 0!==r?r:"";d.creativeId=null!==(J=h.creativeId)&&void 0!==J?J:"";d.requester=h.requester||"VSEWidgetCards";X="vse-component-feed-carousel-"+d.cardId;H="vse-widget-popover-"+d.cardId;if(!c["default"].capabilities.video)return p("videoNotSupported"),
[2];A("cardWidgetRendered");var K=t[0].productAsin?t[0].productAsin:"";d.buildCsmPayload=Aa({placementContext:d.metricsPlacement,clientId:"VSE",eventSource:"VSEWidgetCards",stringPayload:null!==K&&void 0!==K?K:"",creativeId:d.creativeId});if(F||"Detail"===d.pageType)ca(l,t,k);else{c["default"].$("."+d.cardId+" [class*=vsePlaceholder] .a-fixed-right-grid-inner").addClass(q.vseNoRightPadding);r=l;try{ia(r,k,"vse-carousel-items-added-"+X),ia(r,k,"vse:cards:"+d.clientPrefix+":quad:ready")}catch(L){Y(L)}c["default"].trigger("vse-card-ready-"+
X)}(f=c["default"].capabilities.isAmazonApp&&c["default"].capabilities.android&&(c["default"].capabilities.androidVersion+"").startsWith("8"))?(p("useMshopAutoplayFallback"),I()):(Ha(),Ia(),Ja(),Ka(),La());"gatewayquad"===d.clientPrefix&&c["default"].trigger("vse:cards:"+d.clientPrefix+":quad:ready");R&&(ja(null,c["default"].now()),ka())}else p("pageStateNotFound"),I()}catch(L){v("fatal exception has occurred. Exception details: "+L,"FATAL"),p("widgetFatalException"),I()}return[2]})})},ia=function(a,
b,e){c["default"].off(e);c["default"].on(e,function(){P||(P=!0,t=U(C,B,q),ca(a,t,b))})},Ia=function(a){void 0===a&&(a="click touch");c["default"].declarative("vse-widget-carousel-see-more-"+d.cardId,a,function(){return la()});c["default"].declarative("vse-widget-carousel-custom-action-"+d.cardId,a,function(b){var e;(b=null===(e=b.data)||void 0===e?void 0:e.link)?(ma("widgetCustomActionClicked"),ba["default"].setLocation(b)):la()})},la=function(){F&&(W=!0);c["default"].$("."+d.cardId+" .vse-cards-ingress-carousel").find(".vse-carousel-item").first().click();
ma("seeMoreLinkClicked")},ma=function(a){A(a);a=d.buildCsmPayload({eventName:d.clientPrefix+":"+a,intPayload:1});E(a,z)},Ja=function(){var a=0;c["default"].off("a:popover:afterShow:vse-widget-popover-"+d.cardId);c["default"].on("a:popover:afterShow:vse-widget-popover-"+d.cardId,function(b){try{if(c["default"].$(b.popover.$popover).addClass(c["default"].$("#"+H).data("cssClass")),a++,V=!0,1===a){c["default"].$(b.popover.$popover).addClass(q.vseVerticalLightbox);var e=c["default"].now();u&&u.refresh();
R?(c["default"].$(b.popover.$popover).addClass(q.vseRemoveAbsolute),Z()):(ja(b.popover.$popover,e),ka())}else Z()}catch(k){Y(k)}})},ja=function(a,b){c["default"].on(d.clientPrefix+":vse:player:registered",function(){c["default"].$("#"+H+" [class*=_vseWidgetLbVideoBlock_]").first().animate({opacity:1});if(V){Z();c["default"].$(a).addClass(q.vseRemoveAbsolute);var e=c["default"].now()-b;A("cardWidgetPopoverContentWaitTime",e)}});c["default"].on("vse:cards:"+d.clientPrefix+":componentbuilder:failed",
function(){na();u?u.hide():c["default"].trigger("vse:cards:"+d.cardId+":secondary:view:close");R||c["default"].delay(function(){ba["default"].setLocation(Q.videoDetailPageLink)},500)})},Z=function(){W&&c["default"].trigger("vse:"+d.clientPrefix+":page:watchAllClicked");W=!1;c["default"].trigger("vse:"+d.clientPrefix+":page:lightBoxOpened",{assetSpec:Q,lightBoxId:""+H});var a=c["default"].$("#"+H+" [class*=_vseWidgetLbVideoBlock_]");0<a.length&&(N=a.get(0),null!=G&&(Na(N),G.elect(N)))},Ka=function(){c["default"].off("a:popover:beforeHide:vse-widget-popover-"+
d.cardId);c["default"].on("a:popover:beforeHide:vse-widget-popover-"+d.cardId,function(){V=!1;ha?(c["default"].trigger("vse:"+d.clientPrefix+":page:lightBoxClosed"),null!=G&&N&&G.unsubscribe(N)):A("cardWidgetLBClosedBeforeAjax")})},ka=function(){Ca(t,Q,B,function(a){ha=!0;p("preloadSuccess");c["default"].$("#"+H+" [class*=_vseWidgetLbVideoBlock_]").html(a.responseBody)},function(a){c["default"].trigger("vse:cards:"+d.clientPrefix+":componentbuilder:failed");A("preloadFailed");p("preloadFailed:"+a.statusCode);
v("NilgiriService componentbuilder call has failed.\n        Status code: "+a.statusCode+". Status text: "+a.statusText,"FATAL");I()})},I=function(){var a=D["default"].cardRoot.getElementsByClassName(q.vseSeeMoreLink)[0];a&&a.classList&&(a.classList.add("aok-hidden"),F&&(a=D["default"].cardRoot.getElementsByClassName(q.vseWidgetSecondaryViewLinkCaret)[0])&&a.classList&&a.classList.add("aok-hidden"))},Ha=function(){try{[].forEach.call(C,function(a){a.children[0].removeAttribute("target")}),oa(),c["default"].$("."+
d.cardId+" .vse-cards-ingress-carousel").delegate(".vse-carousel-item","click",function(a){P||(t=U(C,B,q),P=!0);if(!c["default"].$(a.target).closest("."+q.vseProfilePlaceholder).length){a.preventDefault();var b=c["default"].$(a.currentTarget);a=b.closest("li").index();var e=t[a];e.metadata&&(Q=da(e,b),b=d.buildCsmPayload({eventName:d.clientPrefix+":cardWidgetClicked",intPayload:1,videoAsin:e.contentId}),A("cardWidgetClicked"),E(b,z),Ba(a,B.celQueryStringParam),F?c["default"].trigger("vse:cards:"+
d.cardId+":secondary:view:open"):(u=ya["default"].get(c["default"].$("."+d.cardId+" #vse-widget-popover-trigger")),c["default"].objectIsEmpty(u)?p("lbNotFoundDesktop"):u.show()))}})}catch(a){Y(a)}},Y=function(a){v("fatal exception has occurred in LB. Exception details: "+a,"FATAL");p("lightboxOpenFatalException");I();na();u&&u.hide()},na=function(){oa();[].forEach.call(C,function(a,b){a.children&&a.children[0]&&a.children[0].setAttribute("target",t[b].metadata.videoDetailPageLink)})},oa=function(){c["default"].$("."+
d.cardId+" .vse-cards-ingress-carousel").undelegate(".vse-carousel-item","click")},Na=function(a){G.subscribe(a,function(b){},{buffer:0})},La=function(){c["default"].on(d.clientPrefix+"-leave-pip",function(a){c["default"].$("."+d.cardId+" .vse-cards-ingress-carousel .vse-carousel-item")[a.index].click()})},x={thumbnailUpdates:"_vse-vw-dp-card_style_thumbnailUpdates__3sx2a",vseVideoImageWrapper:"_vse-vw-dp-card_style_vseVideoImageWrapper__3Sk54",vseCarouselItem:"_vse-vw-dp-card_style_vseCarouselItem__3IvFU",
vseCarouselItemHovering:"_vse-vw-dp-card_style_vseCarouselItemHovering__3nydI",vseHoverSection:"_vse-vw-dp-card_style_vseHoverSection__1n4YC",carouselElement:"_vse-vw-dp-card_style_carouselElement__AVBU9",vseMobileVideoWidget:"_vse-vw-dp-card_style_vseMobileVideoWidget__17sDD",vseDesktopCarousel:"_vse-vw-dp-card_style_vseDesktopCarousel__1UwLK",vseVideoDuration:"_vse-vw-dp-card_style_vseVideoDuration__vDK4S",vseVideoTitle:"_vse-vw-dp-card_style_vseVideoTitle__sPgV5",vseVideoTitleBlockOverlay:"_vse-vw-dp-card_style_vseVideoTitleBlockOverlay__ZyhF4",
vseThumbnailSecondaryImg:"_vse-vw-dp-card_style_vseThumbnailSecondaryImg__2eoNE",vseVideoTitleBlock:"_vse-vw-dp-card_style_vseVideoTitleBlock__Qp7Od",vseVideoTitleText:"_vse-vw-dp-card_style_vseVideoTitleText__1lJWI",vseVideoTitleWithCreator:"_vse-vw-dp-card_style_vseVideoTitleWithCreator__1Meqf",vseHasProfile:"_vse-vw-dp-card_style_vseHasProfile__28XGY",vseVideoCreatorName:"_vse-vw-dp-card_style_vseVideoCreatorName__3M1B_",vseProfilePlaceholder:"_vse-vw-dp-card_style_vseProfilePlaceholder__34FkJ",
vseVideoThumbnailProfile:"_vse-vw-dp-card_style_vseVideoThumbnailProfile__1TFKR",vseLazyLoadSpinner:"_vse-vw-dp-card_style_vseLazyLoadSpinner__2XtFC",vseVideoSegmentHeader:"_vse-vw-dp-card_style_vseVideoSegmentHeader__14ouc",vseFirstItem:"_vse-vw-dp-card_style_vseFirstItem__3h4BK",vseVideoWidgetHeaderBlock:"_vse-vw-dp-card_style_vseVideoWidgetHeaderBlock__2t4B0",vseVideoWidgetHeader:"_vse-vw-dp-card_style_vseVideoWidgetHeader__30B2I",vseWidgetPageState:"_vse-vw-dp-card_style_vseWidgetPageState__2eblq",
vseVideoWidgetContainer:"_vse-vw-dp-card_style_vseVideoWidgetContainer__3HDIT",vseIngressCarousel:"_vse-vw-dp-card_style_vseIngressCarousel__2Knkb",vseCardsVideoThumbnail:"_vse-vw-dp-card_style_vseCardsVideoThumbnail__3xlzJ",vseWidgetLbVideoBlock:"_vse-vw-dp-card_style_vseWidgetLbVideoBlock__VfqBF",vseWidgetLbVideoBlockWrapper:"_vse-vw-dp-card_style_vseWidgetLbVideoBlockWrapper__v6yOr",vseWidgetLbAbsolute:"_vse-vw-dp-card_style_vseWidgetLbAbsolute__bgBq7",vseWidgetLbSpinner:"_vse-vw-dp-card_style_vseWidgetLbSpinner__yjdTV",
vseVerticalLightbox:"_vse-vw-dp-card_style_vseVerticalLightbox__12YT2",vseRemoveAbsolute:"_vse-vw-dp-card_style_vseRemoveAbsolute__2xmeK",vseUploadButton:"_vse-vw-dp-card_style_vseUploadButton__5QCM8",vseUploadButtonIcon:"_vse-vw-dp-card_style_vseUploadButtonIcon__2-eZR",vseVideoDataItem:"_vse-vw-dp-card_style_vseVideoDataItem__2A7tm",vseSearchLandingPageUrl:"_vse-vw-dp-card_style_vseSearchLandingPageUrl__2X_re"};aa._operationNames=[];aa.card=function(){return O.__awaiter(void 0,void 0,void 0,function(){var a,
b,e,k;return O.__generator(this,function(g){switch(g.label){case 0:c["default"].$(".vse-video-widget-dp-container ."+x.vseVideoDataItem).find(".vse-segment-title-RVS_G1").first().addClass(x.vseFirstItem);c["default"].$(".vse-video-widget-dp-container ."+x.vseVideoDataItem).find(".vse-segment-title-RVS_G2").first().addClass(x.vseFirstItem);a=c["default"].capabilities.mobile;b={carouselItemClassName:x.carouselElement,widgetMetricsHandler:function(l,m){var f=c["default"].throttle(function(){l()},500,
{leading:!1});c["default"].on(c["default"].constants.BROWSER_EVENTS.RESIZE,function(){l()});c["default"].$("."+d.cardId+" .a-carousel-goto-prevpage").click(function(){m("left");f()});c["default"].$("."+d.cardId+" .a-carousel-goto-nextpage").click(function(){m("right");f()});a&&(c["default"].off("a:carousel:vse-cards-vw-dp:change:pageNumber"),c["default"].on("a:carousel:vse-cards-vw-dp:change:pageNumber",f))}};if(c["default"].capabilities.mobile&&c["default"].capabilities.isAmazonApp&&(e=D["default"].cardRoot.getElementsByClassName(x.vseWidgetPageState))&&
e[0]&&e[0].dataset){k=e[0].dataset.showSlpUrlTreatment||"C";try{wa["default"].trigger("VSE_VWDP_SLP_486630",k),"T1"===k&&c["default"].$("."+x.vseSearchLandingPageUrl).removeClass("aok-hidden")}catch(l){p("failedToTriggerWeblab")}}return[4,Ma(a,x,null,b,!0)];case 1:return g.sent(),[2]}})})}});
